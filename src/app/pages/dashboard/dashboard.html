<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="user-info" *ngIf="user">
      <span>Welcome, {{ user.name }}!</span>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>
  </header>

  <div class="dashboard-content">
    <!-- User Profile Section -->
    <section class="profile-section" *ngIf="user">
      <h2>Profile Information</h2>
      <div class="profile-card">
        <p><strong>Name:</strong> {{ user.name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <a routerLink="/apply" class="action-btn primary">Submit New Application</a>
        <a routerLink="/" class="action-btn secondary">Browse Jobs</a>
      </div>
    </section>

    <!-- Applications Section -->
    <section class="applications-section">
      <h2>Your Applications</h2>

      <!-- Filter Toolbar -->
      <div class="filter-toolbar" *ngIf="applications.length > 0" style="display:flex; gap:12px; align-items:center; margin:12px 0; flex-wrap:wrap;">
        <label for="positionFilter" style="font-weight:600;">Filter by position:</label>
        <select id="positionFilter" [(ngModel)]="filterPosition" style="padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb;">
          <option value="">All positions</option>
          <option *ngFor="let pos of uniquePositions" [value]="pos">{{ pos }}</option>
        </select>
        <!-- Optional: free-text contains filter; uncomment if desired -->
        <!-- <input [(ngModel)]="filterPosition" placeholder="Type to filter (e.g. Frontend)" style="padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb; min-width:220px;"/> -->
        <span style="color:#6b7280; font-size:14px;">Showing {{ filteredApplications.length }} of {{ applications.length }}</span>
      </div>
      
      <div *ngIf="applications.length === 0" class="no-applications">
        <p>You haven't submitted any applications yet.</p>
        <a routerLink="/apply" class="action-btn primary">Submit Your First Application</a>
      </div>

      <div *ngIf="applications.length > 0" class="applications-grid">
        <div *ngFor="let app of filteredApplications" class="application-card">
          <div class="application-header">
            <h3>{{ app.position }}</h3>
            <span class="status" [class]="getStatusClass('pending')">Pending</span>
          </div>
          
          <div class="application-details">
            <p><strong>Name:</strong> {{ app.fullName }}</p>
            <p><strong>Email:</strong> {{ app.email }}</p>
            <p *ngIf="app.phone"><strong>Phone:</strong> {{ app.phone }}</p>
            <p *ngIf="app.experience"><strong>Experience:</strong> {{ app.experience }}</p>
            <p *ngIf="app.resumeFileName"><strong>Resume:</strong> {{ app.resumeFileName }}</p>
            <p><strong>Submitted:</strong> {{ app.submittedAt | date:'short' }}</p>
          </div>

          <div *ngIf="app.coverLetter" class="cover-letter">
            <h4>Cover Letter:</h4>
            <p>{{ app.coverLetter }}</p>
          </div>

          <!-- Resume Text Collapsible -->
          <details *ngIf="app.resumeText">
            <summary>View Extracted Resume Text</summary>
            <pre style="white-space: pre-wrap; background:#f7f7f7; padding:12px; border-radius:8px; max-height:250px; overflow:auto;">{{ app.resumeText }}</pre>
          </details>

          <div class="application-actions">
            <button (click)="deleteApplication(app.id)" class="delete-btn">Delete Application</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Statistics Section -->
    <section class="stats-section" *ngIf="applications.length > 0">
      <h2>Application Statistics</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>{{ applications.length }}</h3>
          <p>Total Applications</p>
        </div>
        <div class="stat-card">
          <h3>{{ applications.length }}</h3>
          <p>Pending Review</p>
        </div>
        <div class="stat-card">
          <h3>0</h3>
          <p>Interviews Scheduled</p>
        </div>
      </div>
    </section>
  </div>
</div>
